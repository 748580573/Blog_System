<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="permissionAuth">
    <resultMap id="userMap" type="com.heng.blog_system.bean.User">
        <result property="account" column="account"/>
        <result property="password" column="password"/>
        <result property="roleCode" column="role_cole"/>
        <result property="roleName" column="role_name"/>
        <result property="permissionCode" column="permission_code"/>
        <result property="permission" column="permission"/>
    </resultMap>
    <select id="selectUserByAccountCode" resultMap="userMap">
	SELECT
		a.account,
		a.password,
		a.role_cole role_cole,
		a.role_name role_name,
		permission.permission_code permission_code,
		GROUP_CONCAT( DISTINCT permission.permission ) permission
	FROM
		(
		SELECT
			account.account,
			account.password,
			user_role.role_cole,
			role.role_name
		FROM
			account LEFT JOIN user_role ON user_role.user_account = account.account
			LEFT JOIN role ON role.role_code = user_role.role_cole
		WHERE  account.account = #{account}
		) a,
		role_permission,
		permission
	WHERE
		permission.permission_code = role_permission.permission_code
		AND role_permission.role_code = a.role_cole
	GROUP BY
		account
    </select>
</mapper>

